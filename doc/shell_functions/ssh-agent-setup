#!/bin/sh
# Luis Mondesi <lmondesi@bloomberg.net>
# 2012-07-27
#
# . ssh-agent-setup from bashrc-`hostname`
#
# License: GPL

SSH_AUTH_SOCK=`find /tmp -name "agent.[0-9]*" -print|sort|tail -1`

if [ -S "$SSH_AUTH_SOCK" ]; then
    SSH_AGENT_PID=`echo $SSH_AUTH_SOCK|cut -d. -f2`
    export SSH_AUTH_SOCK SSH_AGENT_PID
else
    if [ -e "$SSH_AUTH_SOCK" ]; then
        rm -f $SSH_AUTH_SOCK
    fi
    # remove all empty directories
    rmdir /tmp/ssh-* > /dev/null 2>&1
    unset SSH_AUTH_SOCK SSH_AGENT_PID
    #echo executing: ssh-agent -s
    eval `ssh-agent -s`
fi
for key in ~/.ssh/id_[rd]sa*; do
    if echo $key | egrep -q '\.pub$'; then
        continue
    fi
    ssh-add $key
done
